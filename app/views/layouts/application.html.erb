<!DOCTYPE html>
<html lang="en">
<head>
  <title>Scotch'n'Soda Theatre</title>
  <meta charset='utf-8'>
  <%= stylesheet_link_tag 'style', 'colorbox', 'jquery.autocomplete', 'jui-base', 'jui-custom', :cache => true %>
  <%= javascript_include_tag "http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" %>
  <%= javascript_include_tag "http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js" %>
  <%= javascript_include_tag :defaults, :cache => true %>
  <%= csrf_meta_tag %>
  <% 
  includecal = false
  includecal = true if current_page? dashboard_calendar_path
  begin
    includecal = true if current_page? group_events_path
  rescue ActionController::RoutingError
    #This Space Intentionally Left Blank
  end
  if includecal %>
    <%= stylesheet_link_tag 'fullcalendar', 'cal' %>
    <%= javascript_include_tag 'fullcalendar.min', 'jquery-ui-timepicker-addon', 'cal' %>
  <% end %>
  <% #FIXME there must be a better way to do this...
  includevoting = false
  begin
    includevoting = true if current_page? voting_path
  rescue ActionController::RoutingError
    #See Above
  end
  if includevoting %>
    <%= javascript_include_tag 'votings' %>
  <% end %>
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-9104858-1']);
    _gaq.push(['_setDomainName', '.snstheatre.org']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
</head>
<body>
  <% if current_user and controller_name != 'feedbacks' %>
    <%= render :partial => "layouts/feedback" %>
  <% end %>
  <div id='wrapper'>
    <a name='top'></a>
    <section>
      <header id='header'>
        <h1><%= link_to "Scotch on the Web", dashboard_index_path %></h1>
        <h2><%= flavortext %></h2>
        <% if current_user %>
        <span id='logout' style='color:white;'>
          Logged in as <%= link_to current_user, current_user, :style => 'color:white' %> | <%= link_to "Log Out", destroy_user_session_path, :style => 'color:white' %><br>
        </span>
        <span id='search'>
          <%= form_tag '/dashboard/search', :method => 'get' do %>
            <%= search_field_tag "q", nil, :placeholder => "Search", :class => "placeholder-shim" %>
          <% end %>
        </span>
        <% end %>
      </header>
      <% if current_user then %>
        <%= render "layouts/nav" %>
      <% else %>
        <div id='login'><%= render "layouts/login" %></div>
      <% end %>
      <noscript>
        <article>
          <p>Hey there! It looks like you've got JavaScript turned off.
            Unfortunately, the Powers of the Internet don't work so well without it.
            We've tried to accommodate people in your boat, but the truth is there
            are some landlocked lakes, if you follow the way I've been drifting.
            No guarantees.</p>
        </article>
      </noscript>
      <% if current_user and (!notice.nil? or !alert.nil?) %>
        <article>
          <%= notice %>
          <% if notice and alert %>
          <br>
          <% end %>
          <%= alert %>
        </article>
      <% end %>
      <%= yield %>
      <div id='push'></div>
    </section>
  </div>
  <footer id='footer'>
    <b>Scotch on the Web</b> is designed and developed by the <%= link_to "Scotch'n'Soda Web Team", Group.system_group %><br>
    &copy; 2008-2010 <%= link_to "Scotch'n'Soda Theatre", "http://snstheatre.org" %> at <b>Carnegie Mellon University</b><br>
    Current Version <%= render "layouts/version" %> | <%= mail_to current_webmaster.email, "Help build Scotch on the Web!" %><br>
    <%= link_to "Terms of Use & Privacy Policy", dashboard_terms_url %> | <%= link_to "Back to Top", '#top' %>
  </footer>
  <%= render :partial => 'layouts/sodabar' %>
</body>
</html>
